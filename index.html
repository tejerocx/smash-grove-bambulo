<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smash Grove ‚Äî Bambulo Pickleyard</title>
<link rel="icon" type="image/jpeg" href="f6b5eb3c-a6b6-49ce-981e-d9b127b67ba3.jpg">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
:root {
  --green: #4a9a4a; --green-dark: #1d5a1d; --glow: rgba(74,154,74,.22);
  --bg: #0d1a0d; --card: #131e13; --border: #253825;
  --text: #e4ede4; --muted: #7a9a7a; --input: #1a2a1a;
  --red: #e05a4e; --yellow: #c8a060; --r: 12px;
}
body.light { --bg:#f2ede5; --card:#faf7f2; --border:#c8b898; --text:#1a2e1a; --muted:#5a7a5a; --input:#ece7de; }
body { font-family:'Outfit',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; transition:background .3s,color .3s; }
h1,h2,h3 { font-family:'Bebas Neue',sans-serif; letter-spacing:1px; }
a { color:var(--green); text-decoration:none; }
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

/* NAVBAR */
.nav {
  position:sticky; top:0; z-index:200;
  background:rgba(13,26,13,.95); backdrop-filter:blur(16px);
  border-bottom:1px solid var(--border);
  height:64px; padding:0 28px;
  display:flex; align-items:center; justify-content:space-between;
}
body.light .nav { background:rgba(242,237,229,.95); }
.logo { display:flex; align-items:center; gap:10px; }
.logo-img {
  height:44px; width:44px; border-radius:8px;
  object-fit:cover;
  border:1.5px solid rgba(74,154,74,.35);
  box-shadow:0 2px 10px rgba(0,0,0,.35);
}
.logo-tx { font-family:'Bebas Neue',sans-serif; font-size:1.1rem; letter-spacing:1.5px; line-height:1.15; }
.logo-tx .logo-name { display:block; font-size:1.35rem; letter-spacing:2px; }
.logo-tx .logo-sub { display:block; font-size:.78rem; color:var(--green); letter-spacing:1.5px; }
.nav-r { display:flex; align-items:center; gap:14px; }
.nav-headline {
  font-family:'Bebas Neue',sans-serif; font-size:1.15rem; letter-spacing:2px;
  display:flex; flex-direction:column; align-items:center; line-height:1.1;
  flex:1; text-align:center; pointer-events:none;
}
.nav-headline .hl { color:var(--green); }
.nav-tagline {
  font-family:'Outfit',sans-serif; font-size:.6rem; color:var(--muted);
  letter-spacing:3px; text-transform:uppercase; font-weight:600;
}
@media(max-width:620px) { .nav-headline { display:none; } }
/* switch */
.sw-wrap { display:flex; align-items:center; gap:7px; font-size:.85rem; color:var(--muted); }
.sw { position:relative; width:42px; height:23px; }
.sw input { opacity:0; width:0; height:0; }
.sw-tr {
  position:absolute; inset:0; background:var(--border); border-radius:23px; cursor:pointer; transition:.3s;
}
.sw-tr::before {
  content:''; position:absolute; width:17px; height:17px; left:3px; top:3px;
  background:#fff; border-radius:50%; transition:.3s;
}
.sw input:checked + .sw-tr { background:var(--green); }
.sw input:checked + .sw-tr::before { transform:translateX(19px); }

/* BUTTONS */
.btn {
  display:inline-flex; align-items:center; gap:7px;
  padding:10px 20px; border:none; border-radius:9px;
  font-family:'Outfit',sans-serif; font-size:.9rem; font-weight:600;
  cursor:pointer; transition:all .2s; white-space:nowrap;
}
.btn-p { background:linear-gradient(135deg,var(--green),var(--green-dark)); color:#fff; box-shadow:0 4px 14px var(--glow); }
.btn-p:hover { transform:translateY(-2px); box-shadow:0 8px 22px var(--glow); }
.btn-g { background:var(--input); color:var(--text); border:1px solid var(--border); }
.btn-g:hover { background:var(--border); }
.btn-sm { padding:7px 14px; font-size:.82rem; }
.btn-full { width:100%; justify-content:center; }
.btn-lg { padding:14px 28px; font-size:1rem; }

/* HERO */
.hero { position:relative; overflow:hidden; padding:60px 24px 56px; text-align:center; }
.h-glow {
  position:absolute; top:-60px; left:50%; transform:translateX(-50%);
  width:600px; height:400px; border-radius:50%;
  background:radial-gradient(ellipse,rgba(74,154,74,.16) 0%,transparent 70%); pointer-events:none;
}
.h-grid {
  position:absolute; inset:0; opacity:.025;
  background-image:
    repeating-linear-gradient(0deg,var(--green) 0,var(--green) 1px,transparent 1px,transparent 64px),
    repeating-linear-gradient(90deg,var(--green) 0,var(--green) 1px,transparent 1px,transparent 80px);
  pointer-events:none;
}
.hero-logo {
  display:block; margin:0 auto 24px;
  width:clamp(120px,20vw,180px); height:clamp(120px,20vw,180px);
  object-fit:cover; border-radius:16px;
  border:2px solid rgba(74,154,74,.3);
  box-shadow:0 8px 40px rgba(0,0,0,.55), 0 0 60px rgba(74,154,74,.12);
}
.hero h1 { font-size:clamp(2rem,5vw,3.8rem); line-height:1.05; margin-bottom:6px; }
.hero h1 .hl { color:var(--green); }
.hero-sub { font-family:'Bebas Neue',sans-serif; font-size:clamp(1rem,2.5vw,1.4rem); color:var(--muted); letter-spacing:3px; margin-bottom:22px; }
.hero p { color:var(--muted); font-size:1.05rem; max-width:480px; margin:0 auto 28px; line-height:1.7; }
.h-stats { display:flex; justify-content:center; gap:44px; margin-top:40px; flex-wrap:wrap; }
.st { text-align:center; }
.st-n { font-family:'Bebas Neue',sans-serif; font-size:2rem; color:var(--green); line-height:1; }
.st-l { font-size:.74rem; text-transform:uppercase; letter-spacing:1px; color:var(--muted); }

/* SECTIONS */
.sec { max-width:1080px; margin:0 auto; padding:40px 20px; }
.sec-hd { margin-bottom:26px; }
.sec-hd h2 { font-size:1.9rem; margin-bottom:4px; }
.sec-hd p { color:var(--muted); font-size:.88rem; }

/* COURTS ‚Äî LANDSCAPE LAYOUT */
.courts { display:flex; flex-direction:column; align-items:stretch; gap:18px; }
.cc {
  width:100%; max-width:100%;
  background:var(--card); border:2px solid var(--border);
  border-radius:var(--r); overflow:hidden;
  display:flex; flex-direction:row;
  transition:border-color .25s, box-shadow .25s;
  cursor:default;
}
.cc:hover { border-color:var(--green); box-shadow:0 6px 28px var(--glow); }
.cc.sel { border-color:var(--green); box-shadow:0 0 0 3px rgba(74,154,74,.22); }
.cc.blk { opacity:.6; cursor:not-allowed; }

/* LEFT: Photo panel */
.cc-photo {
  width:240px; flex-shrink:0; position:relative;
  background:linear-gradient(135deg,#0c1c0c,#091409);
  overflow:hidden; min-height:200px;
}
.cc-photo img { width:100%; height:100%; object-fit:cover; display:block; }
.cc-photo-avail {
  position:absolute; top:10px; left:10px;
  font-size:.7rem; font-weight:800; padding:4px 11px; border-radius:20px;
  display:flex; align-items:center; gap:5px; letter-spacing:.3px;
}
.cc-photo-avail.av  { background:var(--green); color:#000; }
.cc-photo-avail.full{ background:var(--red); color:#fff; }
.cc-photo-avail.mnt { background:rgba(140,140,140,.85); color:#fff; }
.cc-photo-bar {
  position:absolute; bottom:0; left:0; right:0;
  background:linear-gradient(transparent,rgba(0,0,0,.82));
  padding:26px 12px 12px;
}
.cc-photo-name { font-family:'Bebas Neue',sans-serif; font-size:1.2rem; letter-spacing:1.5px; color:#fff; display:block; }
.cc-photo-rate { font-size:.75rem; color:rgba(255,255,255,.7); margin-top:1px; }
.cc-photo-feats { display:flex; flex-wrap:wrap; gap:3px; margin-top:5px; }
.cc-photo-feat { font-size:.56rem; padding:2px 5px; background:rgba(255,255,255,.12); border-radius:3px; color:rgba(255,255,255,.75); }

/* RIGHT: Times panel */
.cc-times {
  flex:1; padding:16px 18px 16px;
  display:flex; flex-direction:column; gap:10px;
  overflow:hidden;
}
.cc-times-head {
  display:flex; align-items:flex-start; justify-content:space-between;
  flex-wrap:wrap; gap:8px;
}
.cc-times-title {
  font-family:'Bebas Neue',sans-serif; font-size:1.15rem;
  letter-spacing:1px; display:flex; align-items:center; gap:6px;
}
.cc-times-sub { font-size:.74rem; color:var(--muted); margin-top:1px; }

/* SLOT GRID ‚Äî 5 columns */
.cc-slots-grid {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
}
@media(max-width:900px){ .cc-slots-grid{ grid-template-columns:repeat(4,1fr); } }
@media(max-width:700px){
  .cc { flex-direction:column; }
  .cc-photo { width:100%; min-height:180px; }
  .cc-slots-grid{ grid-template-columns:repeat(3,1fr); }
}
@media(max-width:480px){ .cc-slots-grid{ grid-template-columns:repeat(2,1fr); } }

/* SLOT BUTTON ‚Äî landscape style */
.cc-slot-btn {
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:3px; padding:10px 6px; border-radius:10px;
  font-family:'Outfit',sans-serif; text-align:center;
  cursor:pointer; user-select:none;
  transition: transform .22s cubic-bezier(.34,1.56,.64,1),
              background .18s ease,
              box-shadow .18s ease,
              border-color .18s ease;
  will-change: transform;
}
/* Available */
.cc-slot-btn:not(.taken):not(.past-slot) {
  background:#6ecb35; border:2px solid #52aa1a; color:#0d2a00;
}
.cc-slot-btn:not(.taken):not(.past-slot):hover {
  background:#82e040; border-color:#5ec020;
  transform:translateY(-3px) scale(1.04);
  box-shadow:0 6px 18px rgba(100,200,0,.4);
}
.cc-slot-btn.selected {
  background:#1e7a00; border-color:#155c00; color:#fff;
  transform:translateY(-3px) scale(1.05);
  box-shadow:0 8px 22px rgba(30,122,0,.55);
}
.cc-slot-btn.selected:hover { background:#175f00; }
/* Taken */
.cc-slot-btn.taken {
  background:#d94040; border:2px solid #b52a2a; color:#fff;
  cursor:not-allowed;
}
.cc-slot-btn.taken:hover { transform:none; box-shadow:none; }
/* Past */
.cc-slot-btn.past-slot {
  background:rgba(255,255,255,.04); border:2px solid var(--border);
  color:var(--muted); cursor:not-allowed; opacity:.45;
}
.cc-slot-btn.past-slot:hover { transform:none; box-shadow:none; }

.csl-time  { font-size:.75rem; font-weight:700; line-height:1.2; }
.csl-price { font-size:.72rem; font-weight:800; margin-top:1px; }
.csl-name  { font-size:.62rem; font-weight:600; margin-top:1px; opacity:.9; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100%; }
.csl-tag   { font-size:.56rem; font-weight:900; letter-spacing:.5px; text-transform:uppercase; margin-top:2px; }
.cc-slot-btn.selected .csl-price { color:rgba(255,255,255,.8); }

.cc-slots-empty {
  grid-column:span 5;
  font-size:.8rem; color:var(--muted); font-style:italic;
  text-align:center; padding:18px 0;
}
.cc-book-bar {
  padding:10px 12px; margin-top:2px;
  background:linear-gradient(135deg,rgba(74,154,74,.12),rgba(74,154,74,.04));
  border:1px solid rgba(74,154,74,.3); border-radius:9px;
  display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
}
.cc-book-sum { font-size:.8rem; font-weight:600; color:var(--green); flex:1; }
.cc-date-pick {
  background:var(--input); border:1px solid var(--border);
  border-radius:7px; color:var(--text); font-family:'Outfit',sans-serif;
  font-size:.75rem; padding:5px 9px; cursor:pointer; transition:border-color .2s; flex-shrink:0;
}
.cc-date-pick:focus { outline:none; border-color:var(--green); }

/* legacy ‚Äî kept for compatibility */
.ct,.cb-body,.cn,.cd,.cf,.cr,.cr-s,.feats,.feat,.cb,.cb-av,.cb-mt { display:none; }

/* BOOKING MODAL */
.bk-modal-overlay {
  display:none; position:fixed; inset:0; z-index:300;
  background:rgba(0,0,0,.75); backdrop-filter:blur(8px);
  align-items:center; justify-content:center; padding:16px;
}
.bk-modal-overlay.active { display:flex; }
.bk-modal {
  background:var(--card); border:1px solid var(--border); border-radius:18px;
  width:100%; max-width:520px; max-height:92vh;
  display:flex; flex-direction:column;
  box-shadow:0 28px 70px rgba(0,0,0,.65);
  animation:modalIn .22s cubic-bezier(.34,1.56,.64,1);
}
@keyframes modalIn {
  from { opacity:0; transform:scale(.93) translateY(16px); }
  to   { opacity:1; transform:scale(1) translateY(0); }
}
.bk-modal-hd {
  padding:18px 22px; border-bottom:1px solid var(--border);
  display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
  background:linear-gradient(135deg,rgba(74,154,74,.09),transparent);
  border-radius:18px 18px 0 0; flex-shrink:0;
}
.bk-modal-court { font-family:'Bebas Neue',sans-serif; font-size:1.55rem; letter-spacing:1.5px; }
.bk-modal-meta { font-size:.82rem; color:var(--muted); margin-top:3px; line-height:1.5; }
.bk-modal-x {
  background:var(--input); border:1px solid var(--border); border-radius:8px;
  width:34px; height:34px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; color:var(--text); font-size:1rem; flex-shrink:0; transition:all .2s;
}
.bk-modal-x:hover { background:var(--red); border-color:var(--red); color:#fff; }
.bk-modal-body { overflow-y:auto; padding:22px 22px; flex:1; }
.bk-modal-ft {
  padding:14px 22px; border-top:1px solid var(--border); flex-shrink:0;
  display:flex; gap:10px; background:var(--card); border-radius:0 0 18px 18px;
}
.bk-modal-ft .btn { flex:1; justify-content:center; }

/* FORM */
.frow { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px; }
.fg { margin-bottom:16px; }
.fl { display:block; font-size:.77rem; font-weight:700; text-transform:uppercase; letter-spacing:.6px; color:var(--muted); margin-bottom:6px; }
.fi {
  width:100%; padding:11px 13px;
  background:var(--input); border:1px solid var(--border);
  border-radius:8px; color:var(--text);
  font-family:'Outfit',sans-serif; font-size:.91rem;
  transition:border-color .2s,box-shadow .2s;
}
.fi:focus { outline:none; border-color:var(--green); box-shadow:0 0 0 3px rgba(0,200,83,.12); }
.fi::placeholder { color:var(--muted); }
select.fi option { background:var(--card); }
.court-disp {
  padding:11px 14px; background:var(--input);
  border:1px dashed var(--border); border-radius:8px;
  font-size:.9rem; color:var(--muted); font-style:italic;
}
.court-disp.on { border-style:solid; border-color:var(--green); color:var(--text); font-style:normal; }

/* SLOTS */
.slots { display:grid; grid-template-columns:repeat(auto-fill,minmax(76px,1fr)); gap:7px; margin-top:8px; }
.slot {
  padding:8px 4px; text-align:center;
  background:var(--input); border:1px solid var(--border);
  border-radius:7px; font-size:.75rem; cursor:pointer;
  transition:all .15s; user-select:none;
}
.slot:hover:not(.bkd) { border-color:var(--green); color:var(--green); }
.slot.sel { background:var(--green); border-color:var(--green); color:#000; font-weight:700; }
.slot.bkd { background:rgba(248,81,73,.07); border-color:rgba(248,81,73,.2); color:var(--muted); cursor:not-allowed; text-decoration:line-through; }
.slot-msg { font-size:.78rem; color:var(--muted); }

/* PRICE */
.price-bx { background:var(--input); border:1px solid var(--border); border-radius:var(--r); padding:16px 20px; margin-top:20px; }
.pr { display:flex; justify-content:space-between; font-size:.87rem; padding:5px 0; }
.pr.tot { border-top:1px solid var(--border); margin-top:8px; padding-top:12px; font-size:1.05rem; font-weight:700; color:var(--green); }

/* PAYMENT */
.pay-opts { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.pay-opt { border:2px solid var(--border); border-radius:var(--r); padding:16px; text-align:center; cursor:pointer; background:var(--input); transition:all .2s; }
.pay-opt:hover { border-color:var(--green); }
.pay-opt.on { border-color:var(--green); background:rgba(0,200,83,.06); }
.pay-ic { font-size:1.7rem; margin-bottom:6px; }
.pay-lb { font-weight:700; font-size:.88rem; }

/* GCASH / GOTYME */
.gcash { display:none; margin-top:16px; background:rgba(74,154,74,.06); border:1px solid rgba(74,154,74,.25); border-radius:var(--r); padding:20px; text-align:center; }
.gcash.show { display:block; }
.gc-num { font-size:1.4rem; font-weight:800; color:var(--green); letter-spacing:3px; margin:8px 0; }
.gc-name { font-size:.82rem; color:var(--muted); margin-bottom:14px; }
.qr-img {
  width:230px; height:230px; object-fit:contain;
  border-radius:14px; display:block; margin:12px auto;
  background:#fff; padding:8px;
  border:3px solid rgba(74,154,74,.35);
  box-shadow:0 6px 28px rgba(0,0,0,.45);
}
.qr-scan-wrap { margin:10px 0 6px; }
.qr-scan-hint {
  font-size:.8rem; color:var(--green); font-weight:700;
  margin-top:10px; letter-spacing:.3px;
  background:rgba(74,154,74,.1); border-radius:8px;
  padding:7px 14px; display:inline-block;
}
.gc-note { font-size:.76rem; color:var(--muted); margin-top:12px; line-height:1.7; }
.qr-steps {
  display:flex; justify-content:center; align-items:center;
  gap:6px; font-size:.72rem; color:var(--muted);
  margin:6px 0 2px; flex-wrap:wrap;
}
.qr-step {
  background:var(--input); border:1px solid var(--border);
  border-radius:6px; padding:4px 10px;
}

/* 3-column payment options */
.pay-opts-3 { grid-template-columns:1fr 1fr 1fr; }
@media(max-width:540px){ .pay-opts-3 { grid-template-columns:1fr; } }
.divider { height:1px; background:var(--border); margin:24px 0; }

/* HOW IT WORKS */
.how { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; }
.hc { background:var(--card); border:1px solid var(--border); border-radius:var(--r); padding:24px; text-align:center; transition:border-color .2s,transform .2s; }
.hc:hover { border-color:var(--green); transform:translateY(-3px); }
.hc-ic { font-size:2.2rem; margin-bottom:12px; }
.hc-tt { font-size:1rem; font-weight:700; margin-bottom:7px; }
.hc-ds { font-size:.83rem; color:var(--muted); line-height:1.6; }

/* FOOTER */
footer { background:var(--card); border-top:1px solid var(--border); padding:40px 28px 24px; margin-top:60px; }
.ft-g { max-width:1080px; margin:0 auto; display:grid; grid-template-columns:2fr 1fr 1fr; gap:40px; margin-bottom:28px; }
.ft-d { color:var(--muted); font-size:.87rem; margin-top:12px; line-height:1.7; }
.ft-c h4 { font-size:.76rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--muted); margin-bottom:12px; }
.ft-c ul { list-style:none; }
.ft-c li { margin-bottom:8px; }
.ft-c a { color:var(--muted); font-size:.87rem; transition:color .2s; }
.ft-c a:hover { color:var(--green); }
.ft-bot { max-width:1080px; margin:0 auto; padding-top:20px; border-top:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; font-size:.81rem; color:var(--muted); flex-wrap:wrap; gap:8px; }

/* TOASTS */
.toasts { position:fixed; top:74px; right:20px; z-index:999; display:flex; flex-direction:column; gap:8px; }
.toast { background:var(--card); border:1px solid var(--border); border-radius:var(--r); padding:12px 16px; display:flex; align-items:center; gap:10px; min-width:260px; box-shadow:0 6px 24px rgba(0,0,0,.4); animation:tin .3s ease; }
@keyframes tin { from{transform:translateX(110%);opacity:0} to{transform:translateX(0);opacity:1} }
.toast.ok { border-left:3px solid var(--green); }
.toast.err { border-left:3px solid var(--red); }
.toast.inf { border-left:3px solid #4fc3f7; }
.t-msg { font-size:.86rem; }

/* MODAL */
.overlay { position:fixed; inset:0; background:rgba(0,0,0,.72); backdrop-filter:blur(5px); z-index:500; display:flex; align-items:center; justify-content:center; padding:20px; opacity:0; pointer-events:none; transition:opacity .3s; }
.overlay.show { opacity:1; pointer-events:all; }
.modal { background:var(--card); border:1px solid var(--border); border-radius:16px; width:100%; max-width:510px; max-height:90vh; overflow-y:auto; transform:translateY(20px); transition:transform .3s; }
.overlay.show .modal { transform:translateY(0); }
.m-hd { padding:20px 24px; border-bottom:1px solid var(--border); background:linear-gradient(135deg,rgba(74,154,74,.1),transparent); display:flex; align-items:center; justify-content:space-between; }
.m-hd h2 { font-size:1.42rem; }
.m-x { width:30px; height:30px; border:none; border-radius:7px; background:var(--input); color:var(--text); cursor:pointer; font-size:1rem; display:flex; align-items:center; justify-content:center; transition:background .2s; }
.m-x:hover { background:var(--red); }
.m-body { padding:22px 24px; }
.m-foot { padding:14px 24px; border-top:1px solid var(--border); display:flex; gap:10px; justify-content:flex-end; }
.inv-ref { font-family:'Bebas Neue',sans-serif; font-size:1.8rem; color:var(--green); }
.i-row { display:flex; justify-content:space-between; padding:6px 0; font-size:.87rem; }
.i-row .lb { color:var(--muted); }
.i-row .vl { font-weight:600; }
.i-div { height:1px; background:var(--border); margin:12px 0; }
.i-tot { background:linear-gradient(135deg,rgba(74,154,74,.1),rgba(74,154,74,.03)); border:1px solid rgba(74,154,74,.25); border-radius:var(--r); padding:16px; text-align:center; margin-top:14px; }
.i-amt { font-family:'Bebas Neue',sans-serif; font-size:2.4rem; color:var(--green); }
.e-note { background:rgba(74,154,74,.05); border-left:3px solid var(--green); border-radius:0 8px 8px 0; padding:10px 14px; font-size:.82rem; color:var(--muted); margin-top:14px; }
.bdg { display:inline-block; padding:3px 12px; border-radius:20px; font-size:.72rem; font-weight:800; text-transform:uppercase; letter-spacing:.8px; }
.bdg-p { background:rgba(255,214,0,.12); color:var(--yellow); }
.bdg-c { background:rgba(0,200,83,.12); color:var(--green); }
.bdg-d { background:rgba(128,128,255,.12); color:#8080ff; }
.bdg-x { background:rgba(248,81,73,.12); color:var(--red); }

/* AVAILABILITY BADGE ON COURT CARDS */
.avail-badge {
  display: inline-block;
  font-size: .71rem;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 20px;
  margin-bottom: 4px;
}
.avail-badge.avail    { background: rgba(0,200,83,.12); color: var(--green); }
.avail-badge.full     { background: rgba(248,81,73,.12); color: var(--red); }
.avail-badge.unavail  { background: rgba(140,140,140,.12); color: var(--muted); }

/* AVAILABILITY OVERVIEW */
.avail-panel {
  background: var(--card); border: 1px solid var(--border);
  border-radius: var(--r); padding: 20px 22px; margin-bottom: 26px;
}
.avail-panel-hd {
  display: flex; align-items: center; justify-content: space-between;
  flex-wrap: wrap; gap: 10px; margin-bottom: 6px;
}
.avail-panel-hd h3 { font-size: 1.15rem; }
.avail-date-lbl { font-size: .81rem; color: var(--muted); }
.avail-legend {
  display: flex; flex-wrap: wrap; gap: 10px;
  font-size: .72rem; color: var(--muted); margin-bottom: 14px;
}
.avail-legend span { display: flex; align-items: center; gap: 5px; }
.leg-dot {
  width: 11px; height: 11px; border-radius: 3px; display: inline-block; flex-shrink: 0;
}
.avail-court-row { margin-bottom: 12px; }
.avail-court-row:last-child { margin-bottom: 0; }
.avail-court-lbl {
  font-size: .78rem; font-weight: 700; text-transform: uppercase;
  letter-spacing: .5px; margin-bottom: 6px; display: flex; align-items: center; gap: 8px;
}
.avail-slots-row { display: flex; gap: 3px; overflow-x: auto; padding-bottom: 3px; }
.avail-slots-row::-webkit-scrollbar { height: 3px; }
.avail-slots-row::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
.avail-slot-mini {
  min-width: 36px; height: 30px; border-radius: 6px;
  font-size: .58rem; font-weight: 800; letter-spacing: .2px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; cursor: default; position: relative;
  border: 1px solid transparent;
  transition: transform .12s;
}
.avail-slot-mini.av  { background: rgba(74,154,74,.16); color: var(--green); border-color: rgba(74,154,74,.28); cursor: pointer; }
.avail-slot-mini.av:hover { transform: translateY(-3px); background: rgba(74,154,74,.3); box-shadow: 0 4px 14px rgba(74,154,74,.3); }
.avail-slot-mini.av:active { transform: translateY(0); }
.avail-slot-mini.bk  { background: rgba(248,81,73,.08); color: var(--red);   border-color: rgba(248,81,73,.2); }
.avail-slot-mini.nw  { background: rgba(79,195,247,.13); color: #4fc3f7;     border-color: rgba(79,195,247,.3); }
.avail-slot-mini.ps  { background: rgba(255,255,255,.03); color: var(--muted); opacity: .45; }
.avail-slot-mini.bl  { background: rgba(140,140,140,.07); color: var(--muted); opacity: .4; }
.avail-divider { height: 1px; background: var(--border); margin: 12px 0; }

/* IN-CARD SLOT SECTION ‚Äî legacy kept for non-landscape fallback */
.cc-slots-top { display:none; }
.cc-slots-lbl { display:none; }

/* BOOKING SUMMARY (read-only in form) */
.bk-summary {
  background: linear-gradient(135deg,rgba(74,154,74,.08),rgba(74,154,74,.02));
  border: 1px solid rgba(74,154,74,.25); border-radius: var(--r);
  padding: 16px 18px; margin-bottom: 16px;
}
.bk-sum-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: .88rem; }
.bk-sum-row + .bk-sum-row { border-top: 1px solid rgba(74,154,74,.1); }
.bk-sum-lbl { color: var(--muted); }
.bk-sum-val { font-weight: 600; color: var(--text); text-align: right; }

/* DOWNPAYMENT */
.down-row {
  border-top: 1px dashed rgba(200,160,96,.35);
  margin-top: 8px; padding-top: 10px;
  color: var(--yellow); font-weight: 700; font-size: 1rem;
}
.down-note {
  background: rgba(200,160,96,.08);
  border: 1px solid rgba(200,160,96,.3);
  border-radius: var(--r);
  padding: 11px 14px;
  font-size: .82rem;
  color: var(--yellow);
  margin-top: 10px;
  line-height: 1.6;
}
.cash-note {
  background: rgba(200,160,96,.06);
  border: 1px solid rgba(200,160,96,.25);
  border-radius: var(--r);
  padding: 12px 16px;
  font-size: .84rem;
  color: var(--yellow);
  line-height: 1.6;
  margin-top: 8px;
}

/* RESPONSIVE */
@media(max-width:700px){ .frow{grid-template-columns:1fr;} .ft-g{grid-template-columns:1fr;gap:24px;} .ft-bot{flex-direction:column;text-align:center;} .pay-opts{grid-template-columns:1fr;} }
@media(max-width:480px){ .nav{padding:0 14px;} .bk-modal-body{padding:16px;} .bk-modal-ft{padding:12px 16px;} .sec{padding:32px 14px;} }


/* ‚îÄ‚îÄ REAL-TIME SLOTS ‚îÄ‚îÄ */
.slots-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(86px, 1fr));
  gap: 8px;
  margin-top: 10px;
}
.slot {
  border-radius: 9px;
  border: 1.5px solid var(--border);
  background: var(--input);
  padding: 9px 6px 7px;
  text-align: center;
  cursor: pointer;
  transition: all .15s;
  user-select: none;
  position: relative;
  overflow: hidden;
}
.slot-time { font-size: .78rem; font-weight: 700; line-height: 1.2; }
.slot-end  { font-size: .67rem; color: var(--muted); margin-top: 1px; }
.slot-tag  {
  display: block;
  font-size: .55rem;
  font-weight: 800;
  letter-spacing: .5px;
  text-transform: uppercase;
  margin-top: 4px;
  padding: 1px 5px;
  border-radius: 3px;
  background: rgba(74,154,74,.15);
  color: var(--green);
}

/* States */
.slot.free:hover  { border-color: var(--green); background: rgba(74,154,74,.08); color: var(--green); }
.slot.sel  { background: var(--green); border-color: var(--green); color: #000; }
.slot.sel .slot-end { color: rgba(0,0,0,.6); }
.slot.booked { background: rgba(248,81,73,.06); border-color: rgba(248,81,73,.18); cursor: not-allowed; }
.slot.booked .slot-time { text-decoration: line-through; color: var(--muted); }
.slot.booked .slot-tag.booked-tag { background: rgba(248,81,73,.15); color: var(--red); }
.slot.past { background: rgba(0,0,0,.18); border-color: var(--border); cursor: not-allowed; }
.slot.past .slot-time { color: var(--muted); opacity: .5; }
.slot.past .slot-tag.past-tag { background: rgba(140,140,140,.15); color: var(--muted); }
.slot.now  { border-color: #4fc3f7; background: rgba(79,195,247,.07); }
.slot.now .slot-time { color: #4fc3f7; }
.slot.now .slot-tag { background: rgba(79,195,247,.18); color: #4fc3f7; }

/* Live note banner */
.slots-live-note {
  font-size: .78rem;
  font-weight: 600;
  color: var(--green);
  background: rgba(74,154,74,.07);
  border: 1px solid rgba(74,154,74,.2);
  border-radius: 7px;
  padding: 7px 12px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Legend */
.slot-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 10px;
  font-size: .72rem;
  color: var(--muted);
}
.leg { display: flex; align-items: center; gap: 4px; }

/* Slot msg */
.slot-msg {
  font-size: .82rem;
  color: var(--muted);
  font-style: italic;
  padding: 12px 0;
}

/* ‚îÄ‚îÄ PAGE ANIMATIONS ‚îÄ‚îÄ */
@keyframes navSlideDown {
  from { opacity: 0; transform: translateY(-100%); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes heroZoomIn {
  from { opacity: 0; transform: scale(.8); }
  to   { opacity: 1; transform: scale(1); }
}
@keyframes fadeSlideUp {
  from { opacity: 0; transform: translateY(32px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes floatY {
  0%,100% { transform: translateY(0); }
  50%     { transform: translateY(-10px); }
}
@keyframes btnGlow {
  0%,100% { box-shadow: 0 4px 14px rgba(74,154,74,.22); }
  50%     { box-shadow: 0 8px 32px rgba(74,154,74,.55); }
}
@keyframes statCountFade {
  from { opacity: 0; transform: scale(.75); }
  to   { opacity: 1; transform: scale(1); }
}

/* Navbar slides down on load */
.nav { animation: navSlideDown .55s cubic-bezier(.4,0,.2,1) both; }

/* Hero ‚Äî staggered entrance + continuous float on logo */
.hero-logo {
  animation:
    heroZoomIn .75s cubic-bezier(.34,1.56,.64,1) both,
    floatY 4s ease-in-out .85s infinite;
}
.hero h1    { animation: fadeSlideUp .65s ease .22s both; }
.hero-sub   { animation: fadeSlideUp .55s ease .38s both; }
.hero .btn-p {
  animation:
    fadeSlideUp .55s ease .52s both,
    btnGlow 3s ease 1.2s infinite;
}
.h-stats { animation: fadeSlideUp .55s ease .7s both; }
.st-n    { animation: statCountFade .5s cubic-bezier(.34,1.56,.64,1) .9s both; }

/* Scroll-reveal utility */
.sr {
  opacity: 0;
  transform: translateY(28px);
  transition: opacity .7s ease, transform .7s ease;
}
.sr.in { opacity: 1; transform: translateY(0); }
.sr.d1 { transition-delay: .1s; }
.sr.d2 { transition-delay: .2s; }
.sr.d3 { transition-delay: .3s; }
.sr.d4 { transition-delay: .4s; }

</style>
</head>
<body>

<div class="toasts" id="toasts"></div>

<!-- NAVBAR -->
<nav class="nav">
  <div class="logo">
    <img class="logo-img" src="f6b5eb3c-a6b6-49ce-981e-d9b127b67ba3.jpg" alt="Smash Grove Logo" />
    <span class="logo-tx">
      <span class="logo-name">Smash Grove</span>
      <span class="logo-sub">Bambulo Pickleyard</span>
    </span>
  </div>
  <div class="nav-headline">
    BOOK YOUR COURT <span class="hl">NOW!!!</span>
    <span class="nav-tagline">ITS 002 TIME</span>
  </div>
  <div class="nav-r">
    <div class="sw-wrap">
      <span>‚òÄÔ∏è</span>
      <label class="sw"><input type="checkbox" id="darkTog" checked><span class="sw-tr"></span></label>
      <span>üåô</span>
    </div>
  </div>
</nav>

<!-- COURTS -->
<div class="sec" id="courts" style="padding-top:24px">
  <div class="sec-hd">
    <h2>üèüÔ∏è SELECT A COURT</h2>
    <p>Tap a time slot to select, choose consecutive hours, then press <strong>Book Now</strong>.</p>
  </div>
  <div class="courts" id="courtsGrid"></div>
</div>

<!-- BOOKING MODAL -->
<div class="bk-modal-overlay" id="bookModal" onclick="if(event.target===this) closeBookModal()">
  <div class="bk-modal">

    <!-- Header -->
    <div class="bk-modal-hd">
      <div>
        <div class="bk-modal-court" id="bmCourtName">Court</div>
        <div class="bk-modal-meta" id="bmMeta">‚Äî</div>
      </div>
      <button class="bk-modal-x" onclick="closeBookModal()" type="button">‚úï</button>
    </div>

    <!-- Scrollable body -->
    <div class="bk-modal-body">
      <form id="bookForm" onsubmit="submitBooking(event)">

        <!-- Hidden fields -->
        <input type="hidden" id="bDate" />
        <input type="hidden" id="courtDisp" />

        <!-- Personal info -->
        <div class="frow">
          <div class="fg" style="margin:0">
            <label class="fl" for="bName">üë§ Full Name</label>
            <input type="text" class="fi" id="bName" placeholder="First Name / Last Name" required />
          </div>
          <div class="fg" style="margin:0">
            <label class="fl" for="bPhone">üì± Contact Number</label>
            <input type="tel" class="fi" id="bPhone" placeholder="09XX XXX XXXX" required />
          </div>
        </div>
        <div class="fg">
          <label class="fl" for="bEmail">‚úâÔ∏è Email Address</label>
          <input type="email" class="fi" id="bEmail" placeholder="youremail@gmail.com" required />
        </div>

        <!-- Payment Method -->
        <div class="fg">
          <label class="fl">üí≥ Downpayment Method</label>
          <div class="pay-opts pay-opts-3">
            <div class="pay-opt" data-m="gcash" onclick="pickPay('gcash')">
              <div class="pay-ic">üì≤</div>
              <div class="pay-lb">GCash</div>
              <div style="font-size:.65rem;color:var(--muted);margin-top:3px">Scan QR ¬∑ enter ref #</div>
            </div>
            <div class="pay-opt" data-m="gotyme" onclick="pickPay('gotyme')">
              <div class="pay-ic">üè¶</div>
              <div class="pay-lb">GoTyme</div>
              <div style="font-size:.65rem;color:var(--muted);margin-top:3px">Scan QR ¬∑ enter ref #</div>
            </div>
            <div class="pay-opt" data-m="cash" onclick="pickPay('cash')">
              <div class="pay-ic">üíµ</div>
              <div class="pay-lb">Cash</div>
              <div style="font-size:.65rem;color:var(--muted);margin-top:3px">Pay at front desk</div>
            </div>
          </div>
          <input type="hidden" id="bPay" />
        </div>

        <!-- GCash QR section -->
        <div class="gcash" id="gcashBox">
          <p style="font-size:.84rem;margin-bottom:4px">
            Send <strong id="gcDownAmt" style="color:var(--green);font-size:1.1rem">50%</strong> downpayment via <strong style="color:var(--green)">GCash</strong>
          </p>
          <div class="gc-num">0935 935 5010</div>
          <div class="gc-name">Smash Grove Bambulo Pickleyard</div>
          <div class="qr-steps">
            <span class="qr-step">1Ô∏è‚É£ Open GCash</span>
            <span style="color:var(--muted)">‚Üí</span>
            <span class="qr-step">2Ô∏è‚É£ Scan QR</span>
            <span style="color:var(--muted)">‚Üí</span>
            <span class="qr-step">3Ô∏è‚É£ Enter amount &amp; Pay</span>
          </div>
          <div class="qr-scan-wrap">
            <img src="gcash-qrcode.jpg" class="qr-img" alt="GCash QR Code"
              onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" />
            <div style="display:none;width:230px;height:230px;margin:12px auto;border-radius:14px;background:var(--input);border:2px dashed var(--border);align-items:center;justify-content:center;flex-direction:column;gap:8px">
              <span style="font-size:2rem">üì≤</span>
              <span style="font-size:.78rem;color:var(--muted)">GCash QR loading...</span>
            </div>
            <div class="qr-scan-hint">üì∏ Aim your phone camera at the QR code to pay</div>
          </div>
          <div class="gc-note">After paying, take a screenshot of your receipt ‚Äî bring it on your booking day for verification.</div>
        </div>

        <!-- GoTyme QR section -->
        <div class="gcash" id="gotymeBox">
          <p style="font-size:.84rem;margin-bottom:4px">
            Send <strong id="gtDownAmt" style="color:var(--green);font-size:1.1rem">50%</strong> downpayment via <strong style="color:var(--green)">GoTyme Bank</strong>
          </p>
          <div class="gc-name" style="font-size:.95rem;font-weight:700;color:var(--text);margin-bottom:6px">Smash Grove Bambulo Pickleyard</div>
          <div class="qr-steps">
            <span class="qr-step">1Ô∏è‚É£ Open GoTyme</span>
            <span style="color:var(--muted)">‚Üí</span>
            <span class="qr-step">2Ô∏è‚É£ Scan QR</span>
            <span style="color:var(--muted)">‚Üí</span>
            <span class="qr-step">3Ô∏è‚É£ Enter amount &amp; Pay</span>
          </div>
          <div class="qr-scan-wrap">
            <img src="gotyme-qrcode.jpg" class="qr-img" alt="GoTyme QR Code"
              onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" />
            <div style="display:none;width:230px;height:230px;margin:12px auto;border-radius:14px;background:var(--input);border:2px dashed var(--border);align-items:center;justify-content:center;flex-direction:column;gap:8px">
              <span style="font-size:2rem">üè¶</span>
              <span style="font-size:.78rem;color:var(--muted)">GoTyme QR loading...</span>
            </div>
            <div class="qr-scan-hint">üì∏ Aim your phone camera at the QR code to pay</div>
          </div>
          <div class="gc-note">After paying, take a screenshot of your receipt ‚Äî bring it on your booking day for verification.</div>
        </div>

        <!-- Reference number (GCash & GoTyme) -->
        <div class="fg" id="gcashRefWrap" style="display:none">
          <label class="fl" for="bGcashRef">üîñ Reference / Transaction No. <span id="refMethodLabel" style="color:var(--green);font-weight:700"></span></label>
          <input type="text" class="fi" id="bGcashRef" placeholder="e.g. 1234567890" maxlength="30" />
          <div style="font-size:.74rem;color:var(--muted);margin-top:5px">Found in your app's transaction history after sending payment.</div>
        </div>

        <!-- Cash downpayment note -->
        <div class="cash-note" id="cashNote" style="display:none">
          üíµ Please pay <strong id="cashDownAmt" style="color:var(--green)">50%</strong> downpayment at the front desk before your scheduled session to confirm your slot.
        </div>

        <!-- Price Breakdown -->
        <div class="divider"></div>
        <div class="price-bx">
          <div class="pr"><span>Duration</span><span id="pHrs">0 hrs</span></div>
          <div class="pr"><span>Hourly Rate</span><span id="pRate">‚Ç±0/hr</span></div>
          <div class="pr tot"><span>TOTAL</span><span id="pTot">‚Ç±0.00</span></div>
          <div class="pr down-row"><span>‚ö° 50% Downpayment Required</span><span id="pDown">‚Ç±0.00</span></div>
        </div>
        <div class="down-note" style="margin-top:10px">
          ‚ö†Ô∏è A <strong>50% downpayment</strong> is required to confirm your booking. Send via GCash/GoTyme or pay cash at the front desk.
        </div>

      </form>
    </div>

    <!-- Footer buttons -->
    <div class="bk-modal-ft">
      <button class="btn btn-g" onclick="closeBookModal()" type="button">Cancel</button>
      <button type="submit" form="bookForm" class="btn btn-p">üéæ Confirm Booking</button>
    </div>

  </div>
</div>

<!-- HOW IT WORKS -->
<div class="sec">
  <div class="sec-hd"><h2>HOW IT WORKS</h2></div>
  <div class="how">
    <div class="hc"><div class="hc-ic">üèüÔ∏è</div><div class="hc-tt">Pick a Court</div><div class="hc-ds">Browse courts and compare rates and features.</div></div>
    <div class="hc"><div class="hc-ic">üìÖ</div><div class="hc-tt">Choose Your Time</div><div class="hc-ds">Select date and consecutive time slots from 6 AM to 10 PM.</div></div>
    <div class="hc"><div class="hc-ic">üìù</div><div class="hc-tt">Fill in Details</div><div class="hc-ds">Enter your contact info and preferred payment method.</div></div>
    <div class="hc"><div class="hc-ic">‚úÖ</div><div class="hc-tt">Get Confirmed</div><div class="hc-ds">Receive your booking reference and invoice instantly.</div></div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="ft-g">
    <div>
      <div class="logo">
        <img class="logo-img" src="f6b5eb3c-a6b6-49ce-981e-d9b127b67ba3.jpg" alt="Smash Grove Logo" />
        <span class="logo-tx">
          <span class="logo-name">Smash Grove</span>
          <span class="logo-sub">Bambulo Pickleyard</span>
        </span>
      </div>
      <p class="ft-d">Your go-to platform for pickleball court reservations. Fast, simple, and reliable for all skill levels.</p>
    </div>
    <div class="ft-c">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="#courts">Courts</a></li>
        <li><a href="#courts">Book Now</a></li>
      </ul>
    </div>
    <div class="ft-c">
      <h4>Support</h4>
      <ul>
        <li><a href="#">Contact Us</a></li>
        <li><a href="#">FAQs</a></li>
        <li><a href="#">Terms of Use</a></li>
      </ul>
    </div>
  </div>
  <div class="ft-bot">
    <span>¬© 2026 Smash Grove Bambulo Pickleyard. All rights reserved.</span>
    <span>Built for pickleball lovers</span>
    <br>
    <span> Dev: CT</span>
  </div>
</footer>

<!-- INVOICE MODAL -->
<div class="overlay" id="invModal">
  <div class="modal">
    <div class="m-hd">
      <h2>üéæ BOOKING CONFIRMED!</h2>
      <button class="m-x" onclick="closeModal()">‚úï</button>
    </div>
    <div class="m-body">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px">
        <div>
          <div style="font-size:.71rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px">Reference No.</div>
          <div class="inv-ref" id="iRef">‚Äî</div>
        </div>
        <span class="bdg bdg-p" id="iStatus">Pending</span>
      </div>
      <div class="i-div"></div>
      <div class="i-row"><span class="lb">üë§ Name</span><span class="vl" id="iName">‚Äî</span></div>
      <div class="i-row"><span class="lb">üì± Contact</span><span class="vl" id="iContact">‚Äî</span></div>
      <div class="i-row"><span class="lb">‚úâÔ∏è Email</span><span class="vl" id="iEmail">‚Äî</span></div>
      <div class="i-div"></div>
      <div class="i-row"><span class="lb">üèüÔ∏è Court</span><span class="vl" id="iCourt">‚Äî</span></div>
      <div class="i-row"><span class="lb">üìÖ Date</span><span class="vl" id="iDate">‚Äî</span></div>
      <div class="i-row"><span class="lb">‚è∞ Time</span><span class="vl" id="iTime">‚Äî</span></div>
      <div class="i-row"><span class="lb">‚åõ Duration</span><span class="vl" id="iDur">‚Äî</span></div>
      <div class="i-row"><span class="lb">üí≥ Payment</span><span class="vl" id="iPay">‚Äî</span></div>
      <div id="iGcashRefRow" class="i-row" style="display:none"><span class="lb">üîñ GCash Ref #</span><span class="vl" id="iGcashRef">‚Äî</span></div>
      <div class="i-tot">
        <div style="font-size:.74rem;color:var(--muted);margin-bottom:4px">TOTAL AMOUNT DUE</div>
        <div class="i-amt" id="iTot">‚Ç±0.00</div>
        <div style="margin-top:10px;padding-top:10px;border-top:1px dashed rgba(74,154,74,.3)">
          <div style="font-size:.72rem;color:var(--muted);margin-bottom:2px">50% DOWNPAYMENT</div>
          <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--yellow)" id="iDown">‚Ç±0.00</div>
          <div style="font-size:.7rem;color:var(--muted)" id="iDownNote">‚Äî</div>
        </div>
      </div>
      <div class="e-note" id="iEmailNote">üìß Confirmation email simulated.</div>
    </div>
    <div class="m-foot">
      <button class="btn btn-g" onclick="window.print()">üñ®Ô∏è Print</button>
      <button class="btn btn-p" onclick="closeModal()">Done ‚úì</button>
    </div>
  </div>
</div>

<script>
/* =============================================
   STATE
   ============================================= */
let court = null;
let selSlots = [];
let openHour  = 6;
let closeHour = 22;
let cardSel   = { courtId: null, date: null, slots: [], rate: 0 };
let pricingTiers = [
  { from: 6,  to: 16, rate: 150 },
  { from: 16, to: 24, rate: 250 },
  { from: 0,  to: 4,  rate: 300 },
];

/* =============================================
   HELPERS
   ============================================= */
const $ = id => document.getElementById(id);
const fmt = n => '‚Ç±' + Number(n).toLocaleString('en-PH', {minimumFractionDigits:2});
const fmtT = h => h === 24 ? '12:00 AM' : `${h % 12 || 12}:00 ${h < 12 ? 'AM' : 'PM'}`;
const fmtD = s => {
  if (!s) return '‚Äî';
  return new Date(s + 'T00:00:00').toLocaleDateString('en-PH', {weekday:'long',year:'numeric',month:'long',day:'numeric'});
};
const genRef = () => 'PB-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substr(2,4).toUpperCase();
const nowHour = () => new Date().getHours();
const todayStr = () => { const d = new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; };
const isToday = d => d === todayStr();

function toast(msg, type='ok') {
  const icons = {ok:'‚úÖ', err:'‚ùå', inf:'‚ÑπÔ∏è'};
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${icons[type]}</span><span class="t-msg">${msg}</span>`;
  $('toasts').appendChild(el);
  setTimeout(() => el.remove(), 3800);
}

/* =============================================
   DARK MODE
   ============================================= */
function initDark() {
  const tog = $('darkTog');
  const isDark = localStorage.getItem('pb_dark') !== 'light';
  if (!isDark) document.body.classList.add('light');
  tog.checked = isDark;
  tog.addEventListener('change', () => {
    document.body.classList.toggle('light', !tog.checked);
    localStorage.setItem('pb_dark', tog.checked ? 'dark' : 'light');
  });
}

/* =============================================
   OPERATING HOURS
   ============================================= */
async function loadOperatingHours() {
  const settings = await DB.getSettings();
  openHour  = parseInt(settings.open_hour  || '6');
  closeHour = parseInt(settings.close_hour || '22');
  if (settings.pricing_tiers) {
    try { pricingTiers = JSON.parse(settings.pricing_tiers); } catch(e) {}
  }
  const note = $('slotHoursNote');
  if (note) note.textContent = `(${fmtT(openHour)} ‚Äì ${fmtT(closeHour)} ¬∑ select consecutive hours)`;
}

function getRateForHour(h) {
  for (const t of pricingTiers) {
    const inRange = t.from < t.to
      ? (h >= t.from && h < t.to)
      : (h >= t.from || h < t.to);
    if (inRange) return t.rate;
  }
  return pricingTiers.length > 0 ? Math.min(...pricingTiers.map(t => t.rate)) : 0;
}

const fmtTs = h => h === 24 ? '12A' : `${h % 12 || 12}${h < 12 ? 'A' : 'P'}`;

/* =============================================
   CARD SLOT MULTI-SELECT
   ============================================= */
async function toggleCardSlot(courtId, date, h) {
  await ensureCourt(courtId);
  // Reset if switching court or date
  if (cardSel.courtId !== courtId || cardSel.date !== date) {
    cardSel = { courtId, date, slots: [], rate: 0 };
    // Clear other court bars
    document.querySelectorAll('.cc-book-bar').forEach(b => b.style.display = 'none');
    document.querySelectorAll('.cc-slot-btn.selected').forEach(b => b.classList.remove('selected'));
  }

  const s = cardSel.slots;
  const i = s.indexOf(h);
  if (i === -1) {
    if (s.length === 0) {
      s.push(h);
    } else {
      const mn = Math.min(...s), mx = Math.max(...s);
      if (h === mn - 1 || h === mx + 1) { s.push(h); s.sort((a,b) => a-b); }
      else { toast('Select consecutive hours only.', 'inf'); return; }
    }
  } else {
    const mn = Math.min(...s), mx = Math.max(...s);
    if (h === mn || h === mx) s.splice(i, 1);
    else { toast('Deselect from start or end only.', 'inf'); return; }
  }

  updateCardUI(courtId);
}

function updateCardUI(courtId) {
  const grid = $('cSlots_' + courtId);
  const bar  = $('cBar_'   + courtId);
  const sum  = $('cBarSum_' + courtId);
  if (!grid || !bar) return;

  // Update button selected states
  grid.querySelectorAll('.cc-slot-btn').forEach(btn => {
    const h = parseInt(btn.dataset.h);
    btn.classList.toggle('selected', cardSel.courtId === courtId && cardSel.slots.includes(h));
  });

  // Show/hide Book Now bar
  if (cardSel.courtId === courtId && cardSel.slots.length > 0) {
    const mn    = Math.min(...cardSel.slots);
    const mx    = Math.max(...cardSel.slots);
    const hrs   = cardSel.slots.length;
    const total = cardSel.slots.reduce((s, h) => s + getRateForHour(h), 0);
    sum.textContent = `${fmtT(mn)} ‚Äì ${fmtT(mx+1)} ¬∑ ${hrs} hr${hrs>1?'s':''} ¬∑ ${fmt(total)}`;
    bar.style.display = 'flex';
  } else {
    bar.style.display = 'none';
  }
}

async function proceedToBook(courtId) {
  await ensureCourt(courtId);
  if (!cardSel.courtId || cardSel.slots.length === 0) {
    toast('Please select at least one time slot.', 'inf'); return;
  }

  // Set global state used by submitBooking
  selSlots = [...cardSel.slots];
  $('bDate').value = cardSel.date;

  // Populate modal header
  const mn  = Math.min(...selSlots);
  const mx  = Math.max(...selSlots);
  const hrs = selSlots.length;
  const bookTotal = selSlots.reduce((s, h) => s + getRateForHour(h), 0);
  $('bmCourtName').textContent = court ? court.name : courtId;
  $('bmMeta').textContent = `üìÖ ${fmtD(cardSel.date)}  ¬∑  ‚è∞ ${fmtT(mn)} ‚Äì ${fmtT(mx + 1)}  ¬∑  ${hrs} hr${hrs > 1 ? 's' : ''}  ¬∑  ${fmt(bookTotal)}`;

  updatePrice();

  $('bookModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeBookModal() {
  $('bookModal').classList.remove('active');
  document.body.style.overflow = '';
}

/* =============================================
   CARD DATE PICKER ‚Äî refresh slots per court
   ============================================= */
async function onCardDate(courtId, date) {
  const grid = $('cSlots_' + courtId);
  if (!grid) return;

  grid.innerHTML = `<div class="cc-slots-empty">‚è≥ Loading...</div>`;

  const [courts, bookings, blockedDates] = await Promise.all([
    DB.getCourts(), DB.getBookings(), DB.getBlockedDates()
  ]);

  const c = courts.find(x => x.id === courtId);
  if (!c || c.blocked) {
    grid.innerHTML = `<span class="cc-slots-empty">üîß Under maintenance</span>`;
    return;
  }

  if (blockedDates.includes(date)) {
    grid.innerHTML = `<span class="cc-slots-empty" style="grid-column:span 2">üîí This date is blocked</span>`;
    return;
  }

  // Build slot ‚Üí name map for this date
  const slotNameMap = {};
  bookings.filter(b => b.courtId === courtId && b.date === date && b.status !== 'cancelled')
          .forEach(b => b.slots.forEach(h => {
            slotNameMap[h] = (b.fullName || 'Booked').split(' ')[0];
          }));
  const bookedHrs = new Set(Object.keys(slotNameMap).map(Number));

  const allSlots = Array.from({length: closeHour - openHour}, (_, i) => i + openHour);
  const isToday_ = date === todayStr();
  const curHour  = nowHour();

  // Reset card selection when date changes
  if (cardSel.courtId === courtId) cardSel = { courtId: null, date: null, slots: [], rate: 0 };
  const bar = $('cBar_' + courtId);
  if (bar) bar.style.display = 'none';

  grid.innerHTML = allSlots.map(h => {
    const isPast_   = isToday_ && h <= curHour;
    const isBooked_ = bookedHrs.has(h);
    const timeRange = `${fmtT(h)} ‚Äì ${fmtT(h+1)}`;
    if (isPast_)   return `<div class="cc-slot-btn past-slot"><div class="csl-time">${timeRange}</div><div class="csl-tag">Done</div></div>`;
    if (isBooked_) return `<div class="cc-slot-btn taken"><div class="csl-time">${timeRange}</div><div class="csl-name">üë§ ${slotNameMap[h]}</div></div>`;
    return `<div class="cc-slot-btn" data-h="${h}" onclick="event.stopPropagation(); toggleCardSlot('${courtId}','${date}',${h})"><div class="csl-time">${timeRange}</div><div class="csl-price">‚Ç±${getRateForHour(h)}</div></div>`;
  }).join('');
}

/* proceedToBook loads court data if needed */
async function ensureCourt(courtId) {
  if (court && court.id === courtId) return;
  const courts = await DB.getCourts();
  court = courts.find(c => c.id === courtId) || null;
}

/* =============================================
   COURTS
   ============================================= */
async function renderCourts() {
  const [courts, bookings] = await Promise.all([DB.getCourts(), DB.getBookings()]);
  const today = todayStr();
  const curHour = nowHour();

  $('courtsGrid').innerHTML = courts.map(c => {
    const blk = c.blocked;
    const allSlots = Array.from({length: closeHour - openHour}, (_, i) => i + openHour);

    // Build slot ‚Üí booking name map
    const slotNameMap = {};
    bookings.filter(b => b.courtId === c.id && b.date === today && b.status !== 'cancelled')
            .forEach(b => b.slots.forEach(h => {
              slotNameMap[h] = (b.fullName || 'Booked').split(' ')[0];
            }));
    const bookedHours = new Set(Object.keys(slotNameMap).map(Number));

    const availToday = blk ? 0 : allSlots.filter(h => h > curHour && !bookedHours.has(h)).length;
    const availBadgeCls = blk ? 'mnt' : availToday > 0 ? 'av' : 'full';
    const availBadgeTxt = blk ? 'üîß Maintenance' : availToday > 0 ? `‚ö° ${availToday} available` : '‚õî Fully booked';

    const rateRange = (() => {
      const r = pricingTiers.map(t => t.rate);
      return r.length ? (Math.min(...r) === Math.max(...r) ? `‚Ç±${Math.min(...r)}/hr` : `‚Ç±${Math.min(...r)}‚Äì‚Ç±${Math.max(...r)}/hr`) : `${fmt(c.rate)}/hr`;
    })();

    const courtPhotoHtml = c.photo
      ? `<img src="${c.photo}" alt="${c.name}" style="width:100%;height:100%;object-fit:cover;display:block;position:absolute;inset:0"/>`
      : `<div style="width:100%;height:100%;background:linear-gradient(135deg,#0c1c0c,#091409);display:flex;align-items:center;justify-content:center;position:absolute;inset:0"><svg width="80" height="54" viewBox="0 0 110 74" fill="none"><rect x="2" y="2" width="106" height="70" rx="3" stroke="rgba(74,154,74,.5)" stroke-width="1.8"/><line x1="55" y1="2" x2="55" y2="72" stroke="rgba(74,154,74,.4)" stroke-width="1.4"/><line x1="2" y1="37" x2="108" y2="37" stroke="rgba(74,154,74,.3)" stroke-width="1"/><circle cx="55" cy="37" r="6" stroke="rgba(74,154,74,.35)" stroke-width="1.5"/></svg></div>`;

    const slotsHtml = blk
      ? `<div class="cc-slots-empty">üîß Court is under maintenance</div>`
      : allSlots.map(h => {
          const isPast_   = h <= curHour;
          const isBooked_ = bookedHours.has(h);
          const timeRange = `${fmtT(h)} ‚Äì ${fmtT(h+1)}`;
          if (isPast_)   return `<div class="cc-slot-btn past-slot"><div class="csl-time">${timeRange}</div><div class="csl-tag">Done</div></div>`;
          if (isBooked_) return `<div class="cc-slot-btn taken"><div class="csl-time">${timeRange}</div><div class="csl-name">üë§ ${slotNameMap[h]}</div></div>`;
          return `<div class="cc-slot-btn" data-h="${h}" onclick="event.stopPropagation(); toggleCardSlot('${c.id}','${today}',${h})"><div class="csl-time">${timeRange}</div><div class="csl-price">‚Ç±${getRateForHour(h)}</div></div>`;
        }).join('');

    return `
    <div class="cc${blk?' blk':''}" data-id="${c.id}" ${blk ? `onclick="toast('Court is under maintenance.','err')"` : ''}>

      <!-- LEFT: Photo -->
      <div class="cc-photo">
        ${courtPhotoHtml}
        <div class="cc-photo-avail ${availBadgeCls}">${availBadgeTxt}</div>
        <div class="cc-photo-bar">
          <span class="cc-photo-name">${c.name}</span>
          <div class="cc-photo-rate">${rateRange} ¬∑ ${c.desc}</div>
          <div class="cc-photo-feats">${c.feats.map(f=>`<span class="cc-photo-feat">${f}</span>`).join('')}</div>
        </div>
      </div>

      <!-- RIGHT: Times -->
      <div class="cc-times">
        <div class="cc-times-head">
          <div>
            <div class="cc-times-title">üïê Available times</div>
            <div class="cc-times-sub">Select consecutive slots then tap Book Now</div>
          </div>
          <input type="date" class="cc-date-pick" id="cDate_${c.id}"
            value="${today}" min="${today}"
            onclick="event.stopPropagation()"
            onchange="event.stopPropagation(); onCardDate('${c.id}', this.value)" />
        </div>

        <div class="cc-slots-grid" id="cSlots_${c.id}">${slotsHtml}</div>

        <div class="cc-book-bar" id="cBar_${c.id}" data-rate="${c.rate}" style="display:none">
          <span class="cc-book-sum" id="cBarSum_${c.id}"></span>
          <button class="btn btn-p btn-sm" onclick="event.stopPropagation(); proceedToBook('${c.id}')">Book Now ‚Üí</button>
        </div>
      </div>

    </div>`;
  }).join('');

  const active = bookings.filter(b => b.status !== 'cancelled');
  const totalRev = fmt(active.reduce((s,b) => s+b.total, 0));
  if ($('sCourts')) $('sCourts').textContent = courts.length;
  if ($('sBook'))   $('sBook').textContent   = bookings.length;
  if ($('sRev'))    $('sRev').textContent    = totalRev;

  animateCourtCards();
  animateStat($('sCourts'), String(courts.length));
  animateStat($('sBook'),   String(bookings.length));
  if ($('sRev')) animateStat($('sRev'), totalRev);
}

async function selectCourt(id) {
  const courts = await DB.getCourts();
  court = courts.find(c => c.id === id);
  if (!court) return;
  selSlots = [];
  document.querySelectorAll('.cc').forEach(el => el.classList.toggle('sel', el.dataset.id === id));
  const d = $('courtDisp');
  d.textContent = `${court.name} ‚Äî ${fmt(court.rate)}/hr`;
  d.classList.add('on');

  await renderSlots();
  updatePrice();
}

/* =============================================
   DATE
   ============================================= */
async function onDate() {
  const v = $('bDate').value;
  const blocked = await DB.getBlockedDates();
  if (blocked.includes(v)) {
    toast('This date is blocked for maintenance.', 'err');
    $('bDate').value = '';
    $('slotsGrid').innerHTML = '';
    const m = $('slotMsg');
    m.style.display = '';
    m.textContent = 'That date is unavailable ‚Äî please choose another.';
    return;
  }
  selSlots = [];
  await renderSlots();
  updatePrice();
}

/* =============================================
   TIME SLOTS ‚Äî REAL-TIME AWARE
   ============================================= */
async function getBookedSlots(cid, date) {
  const bookings = await DB.getBookings();
  const s = new Set();
  bookings.forEach(b => {
    if (b.courtId === cid && b.date === date && b.status !== 'cancelled')
      b.slots.forEach(h => s.add(h));
  });
  return s;
}

async function renderSlots() {
  const g = $('slotsGrid'), m = $('slotMsg');
  const date = $('bDate').value;

  if (!court || !date) {
    g.innerHTML = '';
    m.style.display = '';
    m.textContent = court ? 'Now pick a date to see real-time availability.' : 'Select a court and date to see available slots.';
    return;
  }

  m.style.display = 'none';

  const booked = await getBookedSlots(court.id, date);
  const todayFlag = isToday(date);
  const curHour = nowHour();

  let availCount = 0;
  let slotHtml = '';

  for (let h = openHour; h < closeHour; h++) {
    const isPast    = todayFlag && h < curHour;
    const isNow     = todayFlag && h === curHour;
    const isBooked  = booked.has(h);
    const isSel     = selSlots.includes(h);
    const isUnavail = isPast || isBooked;

    if (!isUnavail && !isNow) availCount++;

    let cls = 'slot';
    let tag = '';

    if (isSel)          { cls += ' sel'; }
    else if (isPast)    { cls += ' past'; tag = `<span class="slot-tag past-tag">DONE</span>`; }
    else if (isNow)     { cls += ' now';  tag = `<span class="slot-tag">NOW</span>`; }
    else if (isBooked)  { cls += ' booked'; tag = `<span class="slot-tag booked-tag">TAKEN</span>`; }
    else                { cls += ' free'; }

    slotHtml += `
      <div class="${cls}" data-h="${h}" onclick="toggleSlot(${h})">
        <div class="slot-time">${fmtT(h)}</div>
        <div class="slot-end">${fmtT(h + 1)}</div>
        ${tag}
      </div>`;
  }

  const liveNote = todayFlag
    ? `<div class="slots-live-note">üü¢ Live ¬∑ ${availCount} slot${availCount !== 1 ? 's' : ''} available ¬∑ Now: ${fmtT(curHour)}</div>`
    : `<div class="slots-live-note" style="color:#4fc3f7;background:rgba(79,195,247,.07);border-color:rgba(79,195,247,.2)">üìÖ ${availCount} slot${availCount !== 1 ? 's' : ''} available on this date</div>`;

  const legend = `
    <div class="slot-legend">
      <span class="leg">‚¨ú Available</span>
      <span class="leg" style="color:var(--green)">üü© Selected</span>
      <span class="leg" style="color:var(--red)">üü• Booked</span>
      ${todayFlag ? '<span class="leg" style="color:var(--muted)">‚¨õ Past</span><span class="leg" style="color:#4fc3f7">üîµ Now</span>' : ''}
    </div>`;

  g.innerHTML = liveNote + legend + `<div class="slots-grid">${slotHtml}</div>`;
}

async function toggleSlot(h) {
  if (!court) { toast('Select a court first.', 'inf'); return; }
  const date = $('bDate').value;
  if (!date) { toast('Select a date first.', 'inf'); return; }

  const booked = await getBookedSlots(court.id, date);
  const curHour = nowHour();
  const todayFlag = isToday(date);

  if (booked.has(h)) { toast('This slot is already booked.', 'err'); return; }
  if (todayFlag && h < curHour) { toast('This time slot has already passed.', 'err'); return; }
  if (todayFlag && h === curHour) { toast('This hour is currently in progress ‚Äî book the next available slot.', 'inf'); return; }

  const i = selSlots.indexOf(h);
  if (i === -1) {
    if (selSlots.length === 0) {
      selSlots.push(h);
    } else {
      const mn = Math.min(...selSlots), mx = Math.max(...selSlots);
      if (h === mn - 1 || h === mx + 1) {
        selSlots.push(h); selSlots.sort((a,b) => a - b);
      } else {
        toast('Please select consecutive time slots.', 'inf'); return;
      }
    }
  } else {
    const mn = Math.min(...selSlots), mx = Math.max(...selSlots);
    if (h === mn || h === mx) selSlots.splice(i, 1);
    else { toast('Deselect from start or end only.', 'inf'); return; }
  }
  await renderSlots();
  updatePrice();
}

/* =============================================
   PRICE
   ============================================= */
function updatePrice() {
  const hrs   = selSlots.length;
  const total = selSlots.reduce((s, h) => s + getRateForHour(h), 0);
  const down  = total / 2;
  const rates = pricingTiers.map(t => t.rate);
  const rateLabel = rates.length > 0
    ? `${fmt(Math.min(...rates))} ‚Äì ${fmt(Math.max(...rates))}/hr`
    : (court ? fmt(court.rate) + '/hr' : '‚Äî');
  $('pHrs').textContent  = `${hrs} hr${hrs !== 1 ? 's' : ''}`;
  $('pRate').textContent = rateLabel;
  $('pTot').textContent  = fmt(total);
  $('pDown').textContent = fmt(down);
  if ($('gcDownAmt'))   $('gcDownAmt').textContent   = fmt(down);
  if ($('gtDownAmt'))   $('gtDownAmt').textContent   = fmt(down);
  if ($('cashDownAmt')) $('cashDownAmt').textContent = fmt(down);
}

/* =============================================
   PAYMENT
   ============================================= */
function pickPay(m) {
  document.querySelectorAll('.pay-opt').forEach(el => el.classList.toggle('on', el.dataset.m === m));
  $('bPay').value = m;
  const isDigital = m === 'gcash' || m === 'gotyme';
  $('gcashBox').classList.toggle('show',  m === 'gcash');
  $('gotymeBox').classList.toggle('show', m === 'gotyme');
  $('gcashRefWrap').style.display = isDigital ? '' : 'none';
  $('cashNote').style.display     = m === 'cash' ? '' : 'none';
  if ($('refMethodLabel')) $('refMethodLabel').textContent = m === 'gcash' ? '(GCash)' : m === 'gotyme' ? '(GoTyme)' : '';
  if (isDigital) $('bGcashRef').setAttribute('required','');
  else           $('bGcashRef').removeAttribute('required');
}

/* =============================================
   SUBMIT
   ============================================= */
async function submitBooking(e) {
  e.preventDefault();
  const payMethod = $('bPay').value;
  const gcashRef  = $('bGcashRef').value.trim();
  const checks = [
    [!court, 'Please select a court.'],
    [!$('bDate').value, 'Please select a date.'],
    [selSlots.length === 0, 'Please select at least one time slot.'],
    [!$('bName').value.trim(), 'Please enter your full name.'],
    [!$('bPhone').value.trim(), 'Please enter your contact number.'],
    [!$('bEmail').value.trim(), 'Please enter your email.'],
    [!payMethod, 'Please select a payment method.'],
    [!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($('bEmail').value), 'Please enter a valid email address.'],
    [(payMethod === 'gcash' || payMethod === 'gotyme') && !gcashRef, `Please enter your ${payMethod === 'gotyme' ? 'GoTyme' : 'GCash'} reference number.`],
  ];
  for (const [fail, msg] of checks) { if (fail) { toast(msg, 'err'); return; } }

  const hrs = selSlots.length;
  const startH = Math.min(...selSlots);
  const endH = Math.max(...selSlots) + 1;
  const booking = {
    ref: genRef(),
    fullName: $('bName').value.trim(),
    contactNumber: $('bPhone').value.trim(),
    email: $('bEmail').value.trim(),
    courtId: court.id,
    courtName: court.name,
    date: $('bDate').value,
    slots: [...selSlots],
    startTime: fmtT(startH),
    endTime: fmtT(endH),
    duration: hrs,
    rate: court.rate,
    total: selSlots.reduce((s, h) => s + getRateForHour(h), 0),
    paymentMethod: payMethod,
    gcashRef: gcashRef || null,
    downpayment: selSlots.reduce((s, h) => s + getRateForHour(h), 0) / 2,
    status: 'pending',
    createdAt: new Date().toISOString(),
  };

  try {
    await DB.addBooking(booking);
    showInvoice(booking);
    resetForm();
    toast('Booking submitted successfully! üéæ');
  } catch(err) {
    toast('Failed to save booking. Please try again.', 'err');
  }
}

function resetForm() {
  $('bookForm').reset();
  court = null;
  selSlots = [];
  cardSel = { courtId: null, date: null, slots: [], rate: 0 };
  document.querySelectorAll('.cc-book-bar').forEach(b => b.style.display = 'none');
  document.querySelectorAll('.cc-slot-btn.selected').forEach(b => b.classList.remove('selected'));
  const d = $('courtDisp');
  d.textContent = 'Click a court above to select';
  d.classList.remove('on');
  document.querySelectorAll('.cc').forEach(el => el.classList.remove('sel'));
  $('slotsGrid').innerHTML = '';
  const m = $('slotMsg');
  m.style.display = '';
  m.textContent = 'Select a date above to see real-time availability.';
  $('gcashBox').classList.remove('show');
  $('gotymeBox').classList.remove('show');
  $('gcashRefWrap').style.display = 'none';
  $('cashNote').style.display = 'none';
  $('bGcashRef').value = '';
  document.querySelectorAll('.pay-opt').forEach(el => el.classList.remove('on'));
  closeBookModal();
  updatePrice();
  renderCourts();
}

/* =============================================
   INVOICE MODAL
   ============================================= */
function showInvoice(b) {
  $('iRef').textContent = b.ref;
  $('iName').textContent = b.fullName;
  $('iContact').textContent = b.contactNumber;
  $('iEmail').textContent = b.email;
  $('iCourt').textContent = b.courtName;
  $('iDate').textContent = fmtD(b.date);
  $('iTime').textContent = `${b.startTime} ‚Äì ${b.endTime}`;
  $('iDur').textContent = `${b.duration} hr${b.duration !== 1 ? 's' : ''}`;
  $('iPay').textContent = b.paymentMethod === 'gcash' ? 'GCash' : b.paymentMethod === 'gotyme' ? 'GoTyme Bank' : 'Cash';
  $('iStatus').textContent = 'Pending';
  $('iStatus').className = 'bdg bdg-p';
  $('iTot').textContent  = fmt(b.total);
  $('iDown').textContent = fmt(b.downpayment);
  if (b.gcashRef) {
    $('iGcashRefRow').style.display = '';
    $('iGcashRef').textContent = b.gcashRef;
    $('iDownNote').textContent = `${b.paymentMethod === 'gotyme' ? 'GoTyme' : 'GCash'} downpayment sent ‚úì ‚Äî show receipt at front desk.`;
  } else {
    $('iGcashRefRow').style.display = 'none';
    $('iDownNote').textContent = 'Pay downpayment at front desk before your session.';
  }
  $('iEmailNote').textContent = `üìß Confirmation email simulated to: ${b.email}`;
  $('invModal').classList.add('show');
}

function closeModal() {
  $('invModal').classList.remove('show');
}

/* =============================================
   REAL-TIME ‚Äî Supabase live updates
   ============================================= */
function startRealtime() {
  _supabase.channel('bookings-rt')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'bookings' }, async () => {
      await loadOperatingHours();
      renderCourts();
      if (court && $('bDate').value) renderSlots();
    })
    .subscribe();
}

/* =============================================
   ANIMATIONS
   ============================================= */
function initScrollReveal() {
  // Section headings
  document.querySelectorAll('.sec-hd').forEach(el => el.classList.add('sr'));

  // How-it-works cards ‚Äî stagger
  document.querySelectorAll('.hc').forEach((el, i) => {
    el.classList.add('sr');
    if (i) el.classList.add('d' + Math.min(i, 4));
  });

  // Footer columns ‚Äî stagger
  document.querySelectorAll('.ft-g > div').forEach((el, i) => {
    el.classList.add('sr');
    if (i) el.classList.add('d' + Math.min(i, 4));
  });
  document.querySelector('.ft-bot')?.classList.add('sr', 'd1');

  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => {
      if (e.isIntersecting) { e.target.classList.add('in'); obs.unobserve(e.target); }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -30px 0px' });

  document.querySelectorAll('.sr').forEach(el => obs.observe(el));
}

function animateCourtCards() {
  document.querySelectorAll('.cc').forEach((el, i) => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(24px)';
    el.style.transition = `opacity .5s ease ${i * 0.13}s, transform .5s ease ${i * 0.13}s, border-color .2s, box-shadow .2s`;
    // Double rAF ensures the browser has painted the initial hidden state first
    requestAnimationFrame(() => requestAnimationFrame(() => {
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }));
  });
}

function animateStat(el, final) {
  if (!el) return;
  const isPhp = final.startsWith('‚Ç±');
  const num = parseFloat(final.replace(/[‚Ç±,]/g, ''));
  if (isNaN(num)) return;
  const dur = 950;
  let t0 = null;
  const step = ts => {
    if (!t0) t0 = ts;
    const p = Math.min((ts - t0) / dur, 1);
    const eased = 1 - Math.pow(1 - p, 3);
    const cur = Math.floor(eased * num);
    el.textContent = isPhp ? '‚Ç±' + cur.toLocaleString('en-PH', {minimumFractionDigits: 2}) : cur;
    if (p < 1) requestAnimationFrame(step); else el.textContent = final;
  };
  requestAnimationFrame(step);
}

/* =============================================
   INIT
   ============================================= */
document.addEventListener('DOMContentLoaded', async () => {
  initDark();
  await DB.seedDefaultData();
  await loadOperatingHours();
  await renderCourts();
  startRealtime();
  $('bDate').min = todayStr();
  $('invModal').addEventListener('click', e => { if (e.target === $('invModal')) closeModal(); });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeBookModal(); });
  initScrollReveal();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="supabase-config.js"></script>
</body>
</html>
